<div class="container-fluid reduced-container-padding mb-16">
  <div class="card">
    <div class="container-fluid index">
      <div class="row middle-xs">
        <div class="col-xs-12 col-sm-4">
          <h1 class="d-inline index__title">Productos</h1>
          <div class="index__desc">
            Lista de productos
          </div>
        </div>
        <div class="col-xs-12 col-sm-8">
          <div class="index__ctas f-right">
            <% if params[:status] == 'active' %>
              <%= link_to 'Productos archivados', retailers_products_path(current_retailer, status: 'archived'), class: 'c-red no-style fs-14' %>
            <% else %>
              <%= link_to 'Productos activos', retailers_products_path(current_retailer, status: 'active'), class: 'c-red no-style fs-14' %>
            <% end %>
            <%= link_to new_retailers_product_path, class: 'btn btn--cta hide-on-tablet-and-down' do %>
              <i class="fas fa-plus mr-5"></i>
              Crear producto
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <%= render 'partials/incomplete_retailer' %>

    <div class="container-fluid products">
      <div class="row">
        <div class="col-xs-12">
          <div class="table box">
            <div class="table__header row hide-on-tablet-and-down center-sm">
              <div class="col-sm-1">Imagen</div>
              <div class="col-sm-3">Producto</div>
              <div class="col-sm-1 hide-on-tablet-and-down">Categoria</div>
              <div class="col-sm-3">Mercado Libre</div>
              <div class="col-sm-2">Finanzas</div>
              <div class="col-sm-1">Inventario</div>
              <div class="col-sm-1"></div>
            </div>
            <% @products.each do |product| %>
              <div class="divider"></div>
              <div class="table__item row middle-xs">
                <div class="col-xs-4 col-sm-1">
                  <div class="products__img">
                    <% if product.main_picture_id %>
                      <%= cl_image_tag("#{product.images&.find(product.main_picture_id)&.key}") %>
                    <% elsif product.images&.first&.key.present? %>
                      <%= cl_image_tag("#{product.images&.first&.key}") %>
                    <% else %>
                      <i class="fas fa-camera-retro fs-40 c-grey"></i>
                    <% end %>
                  </div>
                </div>
                <div class="col-xs-7 col-sm-3 t-center"><%= product.title %></div>
                <div class="col-xs-1 table__action-dots p-0 hide-on-md-and-up">
                  <label class="item__dropdown d-inline">
                    <a class="dropdown__button middle" tabindex="-1" href="#!">
                      <i class="fas fa-ellipsis-v m-auto f-right c-black"></i>
                    </a>

                    <ul class="dropdown__menu">
                      <li>
                        <%= link_to retailers_product_path(current_retailer, product), class: 'c-black no-style' do %>
                          <i class="fas fa-eye mr-8"></i>
                          Ver
                        <% end %>
                      </li>
                      <li>
                        <%= link_to edit_retailers_product_path(current_retailer, product), class: 'c-black no-style' do %>
                          <i class="fas fa-edit mr-8"></i>
                          Editar
                        <% end %>
                      </li>
                    </ul>
                  </label>
                </div>
                <div class="col-xs-12 col-sm-1 t-center hide-on-tablet-and-down c-grey">
                  <%= product.category&.name %>
                </div>
                <div class="col-xs-12 col-sm-3 hide-on-sm-and-down">
                  <div class="box">
                    <div class="row">
                      <div class="col-xs-4 col-sm-6 item__descriptor">Estado:</div>
                      <div class="col-xs-2 col-sm-6">
                        <% if product.meli_product_id.present? %>
                          <b class="cookie <%= cookie(product.meli_status) %>"><%= Product.enum_translation(:meli_status, product.meli_status) %></b>
                        <% else %>
                          <b class="cookie <%= cookie('not_published') %>">No publicado</b>
                        <% end %>
                      </div>
                      <% if product.meli_product_id.present? %>
                        <div class="col-xs-4 col-sm-6 item__descriptor">Preguntas:</div>
                        <div class="col-xs-2 col-sm-6"><%= product.questions.size %></div>
                      <% elsif current_retailer.meli_retailer && product.status != 'archived' && current_retailer.incomplete_meli_profile? == false %>
                        <div class="col-xs-6 col-sm-12 t-right mt-10">
                          <%= link_to retailers_upload_product_to_ml_path(current_retailer, product), method: :put, data: { confirm: 'Está seguro de publicar el producto?' }, class: 'btn btn--cta fs-10 p-5' do %>
                            Publicar en MercadoLibre
                          <% end %>
                        </div>
                      <% end %>
                      <!--<div class="col-xs-4 col-sm-6 item__descriptor">Visitas:</div>
                      <div class="col-xs-2 col-sm-6">100</div>-->
                    </div>
                  </div>
                </div>
                <div class="col-xs-12 col-sm-2">
                  <div class="box">
                    <div class="row">
                      <div class="col-xs-4 col-sm-6 item__descriptor">Vendidos:</div>
                      <div class="col-xs-2 col-sm-6"><%= product.sold_quantity %></div>
                      <div class="col-xs-4 col-sm-6 item__descriptor">Precio:</div>
                      <div class="col-xs-2 col-sm-6">$<%= product.price %></div>
                      <div class="col-xs-4 col-sm-6 item__descriptor">Ganancia:</div>
                      <div class="col-xs-2 col-sm-6">$<%= product.sold_quantity.to_i * product.price %></div>
                      <div class="col-xs-4 col-sm-6 hide-on-pc item__descriptor">Disponible:</div>
                      <div class="col-xs-2 col-sm-6 hide-on-pc"><%= product.available_quantity %></div>
                    </div>
                  </div>
                </div>
                <div class="col-xs-12 col-sm-1 t-center hide-on-sm-and-down">
                  Disponible: <b class="<%= product.available_quantity >= 0 ? 'c-green' : 'c-red' %>"><%= product.available_quantity %></b>
                </div>
                <div class="hide-on-sm-and-down m-auto">
                  <label class="item__dropdown d-inline">
                    <a class="dropdown__button middle" tabindex="-1" href="#!">
                      <i class="fas fa-ellipsis-v m-auto f-right c-black"></i>
                    </a>

                    <ul class="dropdown__menu">
                      <li>
                        <%= link_to retailers_product_path(current_retailer, product), class: 'c-black no-style' do %>
                          <i class="fas fa-eye mr-8"></i>
                          Ver
                        <% end %>
                      </li>
                      <li>
                        <%= link_to edit_retailers_product_path(current_retailer, product), class: 'c-black no-style' do %>
                          <i class="fas fa-edit mr-8"></i>
                          Editar
                        <% end %>
                      </li>
                      <% if product.status_archived? %>
                        <li>
                          <%= link_to reactivate_product_retailers_product_path(current_retailer, product), method: :put, class: 'c-green no-style' do %>
                            <i class="fas fa-check mr-8"></i>
                            Reactivar
                          <% end %>
                        </li>
                      <% else %>
                        <li>
                          <%= link_to retailers_archive_product_path(current_retailer, product), method: :put, class: 'c-red no-style', data: { confirm: '¿Estás seguro de archivar este producto (se cerrará la publicación de MercadoLibre)?' } do %>
                            <i class="fas fa-trash-alt mr-8"></i>
                            Archivar
                          <% end %>
                        </li>
                      <% end %>
                    </ul>
                  </label>
                </div>
              </div>
            <% end %>
            <div class="row middle-xs center-xs">
              <div class="col-xs-12">
                <%= paginate @products %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="bubble hide-on-pc">
  <%= link_to new_retailers_product_path do %>
    <i class="fas fa-plus"></i>
  <% end %>
</div>
