<div class="container-fluid product">
  <div class="row card">
    <div class="col-xs-12 col-md-6">
      <h1 class="my-0"><%= @product.title %></h1>
      <div class="product__categories mt-0"><%= @product.category.name %></div>
    </div>
    <div class="col-xs-12 col-md-6 mt-16 t-right">
      <%= link_to retailers_products_path(current_retailer, status: @product.status), class: 'btn btn--cta' do %>
        <i class="fas fa-arrow-left mr-5"></i>
        Volver
      <% end %>
      <%= link_to edit_retailers_product_path(current_retailer, @product), class: 'btn btn--cta' do %>
        <i class="far fa-edit mr-5"></i>
        Editar
      <% end %>
      <%= link_to edit_retailers_product_path(current_retailer, @product), class: 'btn btn--destroy' do %>
        <i class="far fa-trash-alt mr-5"></i>
        Archivar
      <% end %>
    </div>
    <div class="col-xs-12 col-md-7 product__info">
      <div class="box">
        <div class="row center-xs middle-xs">
          <div class="col-xs-9">
            <section class="lazy slider">
              <% @product.images.each do |img| %>
                <div>
                  <%= cl_image_tag("#{img&.key}") %>
                </div>
              <% end %>
            </section>
          </div>
          <div class="col-xs-3">
            <section class="vertical slider">
              <% @product.images.each do |img| %>
                <div>
                  <%= cl_image_tag("#{img&.key}") %>
                </div>
              <% end %>
            </section>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12 c-grey my-8">Descripción:</div>
          <div class="col-xs-12">
            <div class="p-16 c-grey t-justify">
              <%= @product.description %>
            </div>
          </div>
        </div>
        <div class="row info__details">
          <div class="col-xs-12 col-sm-6">
            <% if @product.ml_attributes.present? %>
              <table class="table_details mt-40">
                <% @product.ml_attributes.each do |attribute| %>
                  <tr>
                    <td class="table_details__descriptor">
                      <%= attribute["name"] || attribute["id"] %>
                    </td>
                    <td class="table_details__value">
                      <%= attribute["value_name"] %>
                    </td>
                  </tr>
                <% end %>
              </table>
            <% end %>
          </div>
          <div class="col-xs-12 col-sm-6">
            <table class="table_details mt-40">
              <tr>
                <td class="table_details__descriptor">Precio</td>
                <td class="table_details__value">$<%= @product.price %></td>
              </tr>
              <% if @product.product_variations.present? %>
                <% @product.product_variations.each do |variation| %>
                  <% variation.data['attribute_combinations'].each do |var| %>
                    <tr>
                      <td class="table_details__descriptor">Origen</td>
                      <%= var["name"] || var["id"] %>
                      </td>
                      <td class="table_details__value truncate">
                        <%= var["value_name"] || var["value_id"] %>
                      </td>
                    </tr>
                  <% end %>
                <% end %>
              <% end %>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-md-5">
      <div class="box">
        <div class="row">
          <div class="col-xs-12 card__module p-0">
            <div class="card__title"><i class="fas fa-money-bill-alt c-primary"></i> Finanzas</div>
            <div class="box">
              <div class="row card__submodule center-xs">
                <div class="col-xs-12 submodule col-sm-4">
                  <h2><%= @product.order_items.count %></h2>
                  <h6>Ordenes</h6>
                </div>
                <div class="col-xs-12 submodule col-sm-4">
                  <h2><%= @product.order_items.includes(:order).where(orders: { merc_status: 'success' }).count %></h2>
                  <h6>Ventas</h6>
                </div>
                <div class="col-xs-12 submodule col-sm-4">
                  <h2>$<%= @product.earned %></h2>
                  <h6>Ganancia</h6>
                </div>
              </div>
              <div class="row card__submodule middle-xs center-xs">
                <div class="col-xs-12">
                  <div class="circle my-16">
                    <h2><%= @product.available_quantity.to_i %></h2>
                    <h6>Disponible</h6>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xs-12 card__module">
            <div class="card__title"><i class="fas fa-shopping-cart c-primary"></i> Mercado Libre Info</div>
            <div class="box">
              <div class="row">
                <div class="col-xs-12 col-sm-6">
                  <table class="table_details table_details--underlined w-100">
                    <tr>
                      <td class="table_details__descriptor">Preguntas:</td>
                      <td class="table_details__value"><%= @product.questions.count %></td>
                    </tr>
                    <tr>
                      <td class="table_details__descriptor">Visitas:</td>
                      <td class="table_details__value">500</td>
                    </tr>
                    <tr>
                      <td class="table_details__descriptor">Expiracion:</td>
                      <td class="table_details__value"><%= @product.meli_expiration_time %></td>
                    </tr>
                  </table>
                </div>
                <div class="col-xs-12 col-sm-6">
                  <table class="table_details table_details--underlined w-100">
                    <tr>
                      <td class="table_details__descriptor">Condición:</td>
                      <td class="table_details__value"><%= humanize_ml_condition(@product.condition) %></td>
                    </tr>
                    <tr>
                      <td class="table_details__descriptor">Tipo:</td>
                      <td class="table_details__value"><%= @product.meli_listing_type_id %></td>
                    </tr>
                    <tr>
                      <td class="table_details__descriptor">Enlace:</td>
                      <td class="table_details__value">
                        <div class="truncate">
                          <a href="<%= @product.meli_permalink %>">
                            <%= @product.meli_permalink %>
                          </a>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).on('ready', function() {
    $(".vertical").slick({
      vertical: true,
      verticalSwiping: true,
      slidesToShow: 3,
      asNavFor: '.lazy',
      focusOnSelect: true,
      centerMode: true,
      arrows: false,
      slidesToScroll: 5
    });
    $(".lazy").slick({
      asNavFor: '.vertical',
      slidesToShow: 1,
      slidesToScroll: 1,
      arrows: false,
      fade: true
    });
  });
</script>
