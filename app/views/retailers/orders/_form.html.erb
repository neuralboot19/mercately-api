<div class="box">
  <div class="row">
    <%= form_for [:retailers, @order], html: { class: 'col-xs-12 p-0' } do |f| %>
      <fieldset class="fieldset mt-16">
        <legend>Información de la orden</legend>
        <input type="hidden" id="hidden-merc-status" value="<%= @order.merc_status %>" />
        <% if (action_name == 'edit' || action_name == 'update') && @order.meli_order_id.present? %>
          <div class="my-16">
            <%= f.select :status, Order.statuses.keys.collect { |s| [ Order.enum_translation(:status, s), s ]}, include_blank: false, disabled: Order.statuses.keys.to_a, class: 'input' %>
            <%= f.label :status, 'Status MercadoLibre' %>
          </div>
        <% end %>
        <div class="my-16">
          <%= f.label :customer_id %>
          <%= f.select :customer_id, current_retailer.customers.map { |c| [c.full_name, c.id] }, { include_blank: false }, class: 'input' %>
        </div>
        <div class="links mt-16 mb-24 t-right">
          <a class="btn btn--cta fs-12 fs-sm-and-down-8" onclick="editClient()">
            <i class="fas fa-edit mr-5"></i>
            Editar cliente
          </a>
          <a class="btn btn--cta fs-12 fs-sm-and-down-8" onclick="addClient()">
            <i class="fas fa-plus mr-5"></i>
            Agregar cliente
          </a>
        </div>
        <fieldset id="client-order-form" class="d-none mt-16">
          <legend>Información básica de cliente</legend>
          <div class="row col-xs-12">
            <div class="col-xs-12 index__ctas">
              <label class="btn btn--no-border f-right" onclick="hideClientForm()">
                <i class="fas fa-times mr-5"></i>
                Cerrar
              </label>
            </div>
            <input type="hidden" id="customer_id" />
            <div class="col-xs-12 col-md-6 my-16">
              <label for="customer_first_name">Nombre</label>
              <input id="customer_first_name" class="input" />
            </div>
            <div class="col-xs-12 col-md-6 my-16">
              <label for="customer_last_name">Apellido</label>
              <input id="customer_last_name" class="input" />
            </div>
          </div>
          <div class="row col-xs-12">
            <div class="col-xs-12 col-md-6 my-16">
              <label for="customer_email">Email</label>
              <input id="customer_email" class="input" />
            </div>
            <div class="col-xs-12 col-md-6 my-16">
              <label for="customer_phone">Teléfono</label>
              <input id="customer_phone" class="input" />
            </div>
          </div>
          <div class="btn-box col-xs-12">
            <input type="button" class="btn-btn btn-submit" value="Guardar Cliente" onclick="saveClient()">
          </div>
        </fieldset>
        <div class="my-16">
          <%= f.label :merc_status, 'Status' %>
           <%= f.select :merc_status, Order.merc_statuses.keys.collect { |s| [ Order.enum_translation(:merc_statuses, s), s ]}, { include_blank: false, disabled: @order.disabled_statuses }, onchange: 'showHideFeedback(this);', class: 'input' %>
        </div>
        <fieldset class="fieldset mt-61">
          <legend>Items en la orden</legend>
          <div id="order_items" class="w-100">
            <%= f.fields_for :order_items do |oi| %>
              <%= render "order_items_fields", f: oi %>
            <% end %>
            <% if @order.id.blank? || @order.merc_status == 'pending' %>
              <div class="links mt-16 mb-24 t-right">
                <%= link_to_add_association f, :order_items, partial: 'new_order_items_fields', class: 'btn btn--cta' do %>
                  <i class="fas fa-plus mr-5"></i>
                  Añadir Item
                <% end %>
              </div>
            <% end %>
          </div>
        </fieldset>
        <div id="feedback-container" class="row w-100">
          <div class="w-100">
            <h3>Información de feedback</h3>
          </div>
          <div id="feedback-reason-container" class="my-16 w-100">
            <%= f.label :feedback_reason, 'Motivo' %>
            <%= f.select :feedback_reason, Order.build_feedback_reasons, class: 'input' %>
          </div>
          <div id="feedback-rating-container" class="my-16 w-100">
            <%= f.label :feedback_rating, 'Calificación' %>
            <%= f.select :feedback_rating, Order.feedback_ratings.keys.to_a, disabled: ['positive'], class: 'input' %>
          </div>
          <div class="my-16 w-100">
            <%= f.label :feedback_message, 'Mensaje' %>
            <%= f.text_area :feedback_message, class: 'input' %>
          </div>
        </div>
        <div class="btn-box col-xs-12">
          <%= f.submit 'Guardar', class: 'btn-btn btn-submit m-0' %>
        </div>
      </fieldset>
    <% end %>
  </div>
</div>

<script charset="utf-8">
  <% if @order&.errors&.any? %>
    <% @order.errors.each do |attribute, message| %>
      showtoast("<%= message %>")
    <% end %>
  <% end %>
</script>

<script src="<%= asset_path 'orders/orders.js' %>" charset="utf-8"></script>
